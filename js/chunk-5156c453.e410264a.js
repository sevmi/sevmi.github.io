(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5156c453"],{"31b4":function(e,t,s){"use strict";var i=s("e5b2"),a=s.n(i);a.a},"8a61":function(e,t,s){e.exports=s.p+"img/bg-edu.d28f1028.jpg"},af1e:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"columns"},[s("div",{staticClass:"column col-12 card"},[s("div",{staticClass:"card-image"},[s("img",{staticStyle:{width:"100%"},attrs:{src:e.iBgCard}})]),e.cTime?s("div",{staticClass:"toast toast-primary text-center"},[s("span",{staticClass:"icon icon-time"}),e._v(" "+e._s(e.cTime.getDate())+" "+e._s(e.$parsemi.today().hMonth)+" "),s("b",[e._v(e._s(String(e.cTime.getHours()).padStart(2,"0"))+":"+e._s(String(e.cTime.getMinutes()).padStart(2,"0")))])]):e._e(),s("div",{staticClass:"card-header"},[s("div",{staticClass:"card-title h5"},[e._v("Jadwal Hari Ini")]),s("div",{staticClass:"card-subtitle text-primary"},[e._v(e._s(e.user.name))])]),s("div",{staticClass:"card-body"},e._l(e.schedules,(function(t,i){return s("div",{key:i,staticClass:"tile tile-centered"},[s("div",{staticClass:"tile-content"},[t.subject?s("div",{staticClass:"tile-title text-bold"},[e._v(e._s(t.subject.name))]):e._e(),t.room?s("small",{staticClass:"tile-subtitle text-primary"},[e._v(e._s(t.room.name)+" ("+e._s(t.hourStart)+"-"+e._s(t.hourEnd)+")")]):e._e()]),s("div",{staticClass:"tile-action"},[e.$parsemi.isPos("Guru")?s("div",{staticClass:"btn-group"},[t.isAvailable&&!e.isPresenced(t)?s("button",{staticClass:"btn btn-success",on:{click:function(s){return e.enterConfirm(t,i)}}},[e._v("Masuk")]):e._e(),t.isAvailable&&e.isPresenced(t)?s("button",{staticClass:"btn btn-success",attrs:{disabled:!e.isEnter(t)},on:{click:function(t){return e.goToPresence(i)}}},[e._v("Masuk")]):e._e(),t.diff<0?s("div",{staticClass:"chip"},[s("figure",{staticClass:"avatar",attrs:{"data-initial":"X"}}),s("span",{staticClass:"text-error"},[e._v(e._s(t.diff))])]):e._e(),t.eDiff<=0?s("div",{staticClass:"chip"},[s("figure",{staticClass:"avatar",attrs:{"data-initial":"V"}}),e._v("Selesai ")]):e._e()]):e._e(),e.$parsemi.isPos("Siswa")?s("div",{staticClass:"btn-group"},[t.isAvailable&&!e.isPresenced(t)?s("button",{staticClass:"btn btn-success",on:{click:function(s){return e.getToken(t,i)}}},[e._v("Masuk")]):e._e(),t.isAvailable&&e.isPresenced(t)?s("button",{staticClass:"btn btn-success",attrs:{disabled:!e.isEnter(t)},on:{click:function(t){return e.goToPresence(i)}}},[e._v("Masuk")]):e._e(),t.diff<0?s("div",{staticClass:"chip"},[s("figure",{staticClass:"avatar",attrs:{"data-initial":"X"}}),s("span",{staticClass:"text-error"},[e._v(e._s(t.diff))])]):e._e(),t.eDiff<=0?s("div",{staticClass:"chip"},[s("figure",{staticClass:"avatar",attrs:{"data-initial":"V"}}),e._v("Selesai ")]):e._e()]):e._e()])])})),0)])])},a=[],n=(s("7db0"),s("b0c0"),s("8a61")),r=s.n(n),c=s("3fd0"),l=null,o=null,u={name:"SchedulePage",mounted:function(){var e=c["a"].getTemp("schedules");e&&(this.schedules=e,e.length>0&&this.getPresence())},data:function(){return{iBgCard:r.a,schedules:[],user:this.$parsemi.current(),cTime:null,scheduleIndex:0}},methods:{getServerTime:function(){this.$parsemi.serverTime(this.serverTime)},serverTime:function(e){this.cTime=this.$parsemi.local(new Date(e)),l&&clearTimeout(l),l=setTimeout(this.getServerTime,6e4),this.checkAvailable()},getTimeString:function(e){var t=this.cTime.getFullYear()+"-"+(this.cTime.getMonth()+1)+"-"+this.cTime.getDate()+" ",s=t+e.hourStart,i=t+e.hourEnd,a=new Date(s).getTime(),n=new Date(i).getTime(),r=Math.round((this.cTime.getTime()-a)/6e4*100)/100,c=Math.round((n-this.cTime.getTime())/6e4*100)/100;return{diff:r,eDiff:c}},checkAvailable:function(){if(this.cTime)for(var e=0,t=0;t<this.schedules.length;t++){var s=this.getTimeString(this.schedules[t]),i=s.diff,a=s.eDiff;this.schedules[t].isAvailable=i>=0&&a>0,a<=0&&e++,e>=this.schedules.length&&l&&(clearTimeout(l),this.cTime=null),this.schedules[t].diff=i,this.schedules[t].eDiff=a}},onLogin:function(){this.setLogin(!0)},getPresence:function(){for(var e=[],t=0;t<this.schedules.length;t++){var s={__type:"Pointer",className:"Schedule",objectId:this.schedules[t].objectId};e.push(s)}this.$parsemi.presenceMultiSchedules(e,this.afterGetPresence)},afterGetPresence:function(e){var t=this;if(e&&e.length>0)for(var s=0;s<this.schedules.length;s++){var i=e.find((function(e){return e.get("schedule").id==t.schedules[s].objectId}));i&&(this.schedules[s].presence=i)}this.$parsemi.serverTime(this.serverTime)},enterConfirm:function(e,t,s){var i=this;this.$dialog.confirm({title:"Peringatan!",body:"Apakah Anda sudah siap melaksanakan KBM?"},{okText:"Ya, Masuk",cancelText:"Belum"}).then((function(){i.savePresence(e,t,s);var a=i.$parsemi.current().name,n={messageKey:i.schedules[i.scheduleIndex].objectId,owner:"Bot",message:a+" telah masuk."};i.$parsemi.setMessage((function(){}),n)}))},savePresence:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(o=this.$loading.show(),this.scheduleIndex=t,!s){s="Tepat";var a=this.getTimeString(e);a.diff>10&&(s="Lambat")}var n="Self";this.$parsemi.isPos("Siswa")&&(n="Token:"+i);var r={status:s,approve:this.$parsemi.current().objectId,subject:e.objectId,date:this.$parsemi.today().dDate,source:n},c=e.presence;if(c){var l=c.get("metaData");l[this.$parsemi.today().weekMonth]=r;var u=c.get("total");u.Total=u.Total>0?u.Total+1:1,u[s]=u[s]>0?u[s]+1:1,c.set("metaData",l),c.set("total",u),c.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler)}else{var h={owner:{__type:"Pointer",className:"_User",objectId:this.user.objectId},schedule:{__type:"Pointer",className:"Schedule",objectId:e.objectId},dMonth:this.$parsemi.today().dMonth,total:{Total:1},metaData:[null,null,null,null]};h.total["Week"]=this.getNumbersDow(e.dow),h.total[s]=1,h.metaData[this.$parsemi.today().weekMonth]=r,this.$parsemi.setPresence(h,this.settlePresence)}},getNumbersDow:function(e){var t=this.$parsemi.local();if(e>7)return!1;var s=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();if(28==s)return 4;var i=new Date(t.getFullYear(),t.getMonth(),1),a=i.getDay()+1;if(29==s)return e==a?5:4;var n={30:1,31:2},r=a+n[s];if(e>=a&&e<=r)return 5;if(r>7){var c=r%7;return e<=c?5:4}return 4},isPresenced:function(e){var t=e.presence;if(t){var s=t.get("metaData");if(s.length>0)return s[this.$parsemi.today().weekMonth]}return!1},isEnter:function(e){var t=e.presence;if(t){var s=t.get("metaData");if(s.length>0){var i=s[this.$parsemi.today().weekMonth];if("Tepat"==i.status||"Lambat"==i.status)return!0}}return!1},settlePresence:function(e){this.schedules[this.scheduleIndex].presence=e,o&&o.hide(),this.goToPresence(this.scheduleIndex)},goToPresence:function(e){c["a"].saveTemp("schedule",this.schedules[e]),this.$router.push("/presence")},getToken:function(e,t){var s=this;this.scheduleIndex=t,this.$dialog.prompt({title:"Masukkan Token"},{okText:"Masuk",cancelText:"Batal"}).then((function(t){t.data?s.$parsemi.getToken(s.afterGetToken,e.objectId,t.data):s.$dialog.alert({title:"Informasi",body:"Token tidak boleh kosong!"},{okText:"Ok"})}))},afterGetToken:function(e){if(e){var t=this.getTimeString(e);if(t.eDiff>0){if(this.savePresence(this.schedules[this.scheduleIndex],this.scheduleIndex,null,e.token),this.$parsemi.isPos("Siswa")){var s=this.$parsemi.current().name,i={messageKey:this.schedules[this.scheduleIndex].objectId,owner:"Bot",message:s+" telah masuk."};this.$parsemi.setMessage((function(){}),i)}}else this.$dialog.alert({title:"Informasi",body:"Waktu Token ini habis. Silahkan hubungi Pengajar."},{okText:"Ok"})}else this.$dialog.alert({title:"Informasi",body:"Token tidak tersedia!"},{okText:"Ok"})}},beforeRouteLeave:function(e,t,s){l&&clearTimeout(l),s()}},h=u,d=(s("31b4"),s("2877")),f=Object(d["a"])(h,i,a,!1,null,"3d8fae35",null);t["default"]=f.exports},b0c0:function(e,t,s){var i=s("83ab"),a=s("9bf2").f,n=Function.prototype,r=n.toString,c=/^\s*function ([^ (]*)/,l="name";i&&!(l in n)&&a(n,l,{configurable:!0,get:function(){try{return r.call(this).match(c)[1]}catch(e){return""}}})},e5b2:function(e,t,s){}}]);
//# sourceMappingURL=chunk-5156c453.e410264a.js.map