{"version":3,"sources":["webpack:///./src/views/presence/schedule/Schedule.vue?d0e7","webpack:///./src/assets/bg-edu.jpg","webpack:///./src/views/presence/schedule/schedule.html","webpack:///src/views/presence/schedule/Schedule.vue","webpack:///./src/views/presence/schedule/Schedule.vue?85b2","webpack:///./src/views/presence/schedule/Schedule.vue","webpack:///./node_modules/core-js/modules/es.function.name.js"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","attrs","iBgCard","_v","_s","cTime","getDate","$parsemi","today","hMonth","String","getHours","padStart","getMinutes","_e","user","name","_l","item","index","key","subject","room","hourStart","hourEnd","isPos","isAvailable","isPresenced","on","$event","enterConfirm","isEnter","goToPresence","diff","eDiff","getToken","staticRenderFns","schedules","current","scheduleIndex","component","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","match","error"],"mappings":"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","file":"js/chunk-5156c453.e410264a.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Schedule.vue?vue&type=style&index=0&id=3d8fae35&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Schedule.vue?vue&type=style&index=0&id=3d8fae35&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/bg-edu.d28f1028.jpg\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"columns\"},[_c('div',{staticClass:\"column col-12 card\"},[_c('div',{staticClass:\"card-image\"},[_c('img',{staticStyle:{\"width\":\"100%\"},attrs:{\"src\":_vm.iBgCard}})]),(_vm.cTime)?_c('div',{staticClass:\"toast toast-primary text-center\"},[_c('span',{staticClass:\"icon icon-time\"}),_vm._v(\" \"+_vm._s(_vm.cTime.getDate())+\" \"+_vm._s(_vm.$parsemi.today().hMonth)+\" \"),_c('b',[_vm._v(_vm._s(String(_vm.cTime.getHours()).padStart(2, '0'))+\":\"+_vm._s(String(_vm.cTime.getMinutes()).padStart(2, '0')))])]):_vm._e(),_c('div',{staticClass:\"card-header\"},[_c('div',{staticClass:\"card-title h5\"},[_vm._v(\"Jadwal Hari Ini\")]),_c('div',{staticClass:\"card-subtitle text-primary\"},[_vm._v(_vm._s(_vm.user.name))])]),_c('div',{staticClass:\"card-body\"},_vm._l((_vm.schedules),function(item,index){return _c('div',{key:index,staticClass:\"tile tile-centered\"},[_c('div',{staticClass:\"tile-content\"},[(item.subject)?_c('div',{staticClass:\"tile-title text-bold\"},[_vm._v(_vm._s(item.subject.name))]):_vm._e(),(item.room)?_c('small',{staticClass:\"tile-subtitle text-primary\"},[_vm._v(_vm._s(item.room.name)+\" (\"+_vm._s(item.hourStart)+\"-\"+_vm._s(item.hourEnd)+\")\")]):_vm._e()]),_c('div',{staticClass:\"tile-action\"},[(_vm.$parsemi.isPos('Guru'))?_c('div',{staticClass:\"btn-group\"},[(item.isAvailable && !_vm.isPresenced(item))?_c('button',{staticClass:\"btn btn-success\",on:{\"click\":function($event){return _vm.enterConfirm(item, index)}}},[_vm._v(\"Masuk\")]):_vm._e(),(item.isAvailable && _vm.isPresenced(item))?_c('button',{staticClass:\"btn btn-success\",attrs:{\"disabled\":!_vm.isEnter(item)},on:{\"click\":function($event){return _vm.goToPresence(index)}}},[_vm._v(\"Masuk\")]):_vm._e(),(item.diff < 0)?_c('div',{staticClass:\"chip\"},[_c('figure',{staticClass:\"avatar\",attrs:{\"data-initial\":\"X\"}}),_c('span',{staticClass:\"text-error\"},[_vm._v(_vm._s(item.diff))])]):_vm._e(),(item.eDiff <= 0)?_c('div',{staticClass:\"chip\"},[_c('figure',{staticClass:\"avatar\",attrs:{\"data-initial\":\"V\"}}),_vm._v(\"Selesai \")]):_vm._e()]):_vm._e(),(_vm.$parsemi.isPos('Siswa'))?_c('div',{staticClass:\"btn-group\"},[(item.isAvailable && !_vm.isPresenced(item))?_c('button',{staticClass:\"btn btn-success\",on:{\"click\":function($event){return _vm.getToken(item, index)}}},[_vm._v(\"Masuk\")]):_vm._e(),(item.isAvailable && _vm.isPresenced(item))?_c('button',{staticClass:\"btn btn-success\",attrs:{\"disabled\":!_vm.isEnter(item)},on:{\"click\":function($event){return _vm.goToPresence(index)}}},[_vm._v(\"Masuk\")]):_vm._e(),(item.diff < 0)?_c('div',{staticClass:\"chip\"},[_c('figure',{staticClass:\"avatar\",attrs:{\"data-initial\":\"X\"}}),_c('span',{staticClass:\"text-error\"},[_vm._v(_vm._s(item.diff))])]):_vm._e(),(item.eDiff <= 0)?_c('div',{staticClass:\"chip\"},[_c('figure',{staticClass:\"avatar\",attrs:{\"data-initial\":\"V\"}}),_vm._v(\"Selesai \")]):_vm._e()]):_vm._e()])])}),0)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template src=\"./schedule.html\" />\r\n\r\n<style scoped>\r\n  .head-list {\r\n    margin-bottom: 20px;\r\n    font-size: 25px;\r\n  }\r\n  .tile {\r\n    margin-bottom: 10px;\r\n  }\r\n</style>\r\n\r\n<script>\r\n  import iBgCard from \"@/assets/bg-edu.jpg\"\r\n  import Storage from \"@/components/Storage\"\r\n\r\n  let sto = null;\r\n  let loader = null;\r\n\r\n  export default {\r\n    name: 'SchedulePage',\r\n    mounted() {\r\n      const schedules = Storage.getTemp('schedules');\r\n      if(schedules){\r\n        this.schedules = schedules;\r\n        if(schedules.length > 0){\r\n          this.getPresence();\r\n        }\r\n      }\r\n    },\r\n    data () {\r\n    return {\r\n      iBgCard: iBgCard,\r\n      schedules: [],\r\n      user: this.$parsemi.current(),\r\n      cTime: null,\r\n      scheduleIndex: 0,\r\n    }},\r\n    methods: {\r\n      getServerTime(){\r\n        this.$parsemi.serverTime(this.serverTime);\r\n      },\r\n      serverTime(data){\r\n        // make sure we have locally\r\n        this.cTime = this.$parsemi.local(new Date(data));\r\n        if(sto)\r\n          clearTimeout(sto);\r\n        sto = setTimeout(this.getServerTime, 60000);\r\n        this.checkAvailable();\r\n      },\r\n      getTimeString(item){\r\n        const strTime = this.cTime.getFullYear() + \"-\" + (this.cTime.getMonth()+1) + \"-\" + this.cTime.getDate() + \" \";\r\n        const timeStart = strTime + item.hourStart;\r\n        const timeEnd = strTime + item.hourEnd;\r\n        const st = new Date(timeStart).getTime();\r\n        const et = new Date(timeEnd).getTime();\r\n        const diff = Math.round(((this.cTime.getTime() - st) / 60000)*100)/100;\r\n        const eDiff = Math.round(((et - this.cTime.getTime()) / 60000)*100)/100;\r\n        return {diff: diff, eDiff: eDiff};\r\n      },\r\n      checkAvailable(){\r\n        if(!this.cTime)\r\n          return;\r\n        let allEnd = 0;\r\n        for (var i = 0; i < this.schedules.length; i++) {\r\n          const gts = this.getTimeString(this.schedules[i]);\r\n          const diff = gts.diff;\r\n          const eDiff = gts.eDiff;\r\n          if(diff >= 0 && eDiff > 0){\r\n            this.schedules[i].isAvailable = true;\r\n          } else {\r\n            this.schedules[i].isAvailable = false;\r\n          }\r\n          if(eDiff <=0 ){\r\n            allEnd++;\r\n          }\r\n\r\n          if(allEnd >= this.schedules.length){\r\n            if(sto){\r\n              clearTimeout(sto);\r\n              this.cTime = null;\r\n            }\r\n          }\r\n          this.schedules[i].diff = diff;\r\n          this.schedules[i].eDiff = eDiff;\r\n        }\r\n      },\r\n      onLogin(){\r\n        this.setLogin(true);\r\n      },\r\n      getPresence(){\r\n        let schedules = [];\r\n        for (var i = 0; i < this.schedules.length; i++) {\r\n          const s = {__type:'Pointer',className:'Schedule', objectId:this.schedules[i].objectId};\r\n          schedules.push(s);\r\n        }\r\n        this.$parsemi.presenceMultiSchedules(schedules, this.afterGetPresence);\r\n      },\r\n      afterGetPresence(data){\r\n        if(data && data.length > 0){\r\n          for (var i = 0; i < this.schedules.length; i++) {\r\n            const p = data.find(item => item.get('schedule').id == this.schedules[i].objectId);\r\n            if(p){\r\n              this.schedules[i].presence = p;\r\n            }\r\n          }\r\n        }\r\n        this.$parsemi.serverTime(this.serverTime);\r\n      },\r\n      enterConfirm(item, index, status){\r\n        // TODO:'Apakah Anda sudah di tempat KBM berlangsung?'\r\n        this.$dialog\r\n        .confirm({title:\"Peringatan!\", body:'Apakah Anda sudah siap melaksanakan KBM?'}, {okText:'Ya, Masuk', cancelText:'Belum'})\r\n        .then(() => {\r\n          this.savePresence(item, index, status);\r\n          const name =  this.$parsemi.current().name;\r\n          const message = {messageKey: this.schedules[this.scheduleIndex].objectId, owner: \"Bot\", message: name + \" telah masuk.\"};\r\n          this.$parsemi.setMessage(()=>{}, message);\r\n        });\r\n      },\r\n      // item = schedule\r\n      // TODO STATUS, see enterConfirm(item, index, status)\r\n      savePresence(item, index, status=null, token=null){\r\n        loader = this.$loading.show();\r\n        this.scheduleIndex = index;\r\n        if(!status){\r\n          status = \"Tepat\";\r\n          const gts = this.getTimeString(item);\r\n          if(gts.diff > 10){\r\n            status = \"Lambat\";\r\n          }\r\n        }\r\n        let source = 'Self';\r\n        if(this.$parsemi.isPos('Siswa'))\r\n          source = 'Token:' + token;\r\n        const mdNow = {'status': status, 'approve': this.$parsemi.current().objectId, 'subject': item.objectId, 'date': this.$parsemi.today().dDate, 'source': source};\r\n        let presence = item.presence;\r\n        if(presence){\r\n          let metaData = presence.get('metaData');\r\n          metaData[this.$parsemi.today().weekMonth] = mdNow;\r\n          let total = presence.get('total');\r\n          total.Total = total.Total > 0 ? (total.Total + 1) : 1;\r\n          total[status] = total[status] > 0 ? (total[status] + 1) : 1;\r\n          presence.set('metaData', metaData);\r\n          presence.set('total', total);\r\n          presence.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler);\r\n        } else {\r\n          let presenceData = {\r\n            owner: {__type:'Pointer',className:'_User', objectId: this.user.objectId},\r\n            schedule: {__type:'Pointer',className:'Schedule',objectId:item.objectId},\r\n            dMonth: this.$parsemi.today().dMonth,\r\n            total: { Total: 1 },\r\n            metaData: [null, null, null, null],\r\n          };\r\n          presenceData.total['Week'] = this.getNumbersDow(item.dow);\r\n          presenceData.total[status] = 1;\r\n          presenceData.metaData[this.$parsemi.today().weekMonth] = mdNow;\r\n          this.$parsemi.setPresence(presenceData, this.settlePresence);\r\n        }\r\n      },\r\n      getNumbersDow(dow){\r\n        const date = this.$parsemi.local();\r\n        if(dow > 7) \r\n          return false;\r\n        const numDays = new Date(date.getFullYear(), date.getMonth()+1, 0).getDate();\r\n        if(numDays == 28){\r\n          return 4;\r\n        }\r\n        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);\r\n        const firstDow = firstDay.getDay() + 1;\r\n        if(numDays == 29){\r\n          if(dow == firstDow)\r\n            return 5;\r\n          else\r\n            return 4;\r\n        }\r\n        const rule = {'30': 1, '31': 2};\r\n        const max = (firstDow + rule[numDays]);\r\n        if(dow >= firstDow && dow <= max){\r\n          return 5;\r\n        }\r\n        // if out of week number\r\n        if(max > 7){\r\n          const rd = max % 7;\r\n          if(dow <= rd)\r\n            return 5;\r\n          else \r\n            return 4;\r\n        }\r\n        return 4;\r\n      },\r\n      isPresenced(item){\r\n        const presence = item.presence;\r\n        if(presence){\r\n          const md = presence.get('metaData');\r\n          if(md.length > 0){\r\n            return md[this.$parsemi.today().weekMonth];\r\n          }\r\n        }\r\n        return false;\r\n      },\r\n      isEnter(item){\r\n        const presence = item.presence;\r\n        if(presence){\r\n          const md = presence.get('metaData');\r\n          if(md.length > 0){\r\n            const s = md[this.$parsemi.today().weekMonth];\r\n            if(s.status == \"Tepat\" || s.status == \"Lambat\")\r\n              return true;\r\n          }\r\n        }\r\n        return false;\r\n      },\r\n      settlePresence(d){\r\n        this.schedules[this.scheduleIndex].presence = d;\r\n        if(loader)\r\n          loader.hide();\r\n        this.goToPresence(this.scheduleIndex);\r\n      },\r\n      goToPresence(index){\r\n        Storage.saveTemp('schedule', this.schedules[index]);\r\n        this.$router.push('/presence');\r\n      },\r\n      getToken(sch, index){\r\n        this.scheduleIndex = index;\r\n        this.$dialog\r\n          .prompt({\r\n            title: \"Masukkan Token\",\r\n          }, {okText: \"Masuk\", cancelText: \"Batal\"})\r\n          .then(dialog => {\r\n            if(!dialog.data)\r\n              this.$dialog.alert({title: \"Informasi\", body: \"Token tidak boleh kosong!\"}, {okText: \"Ok\"});\r\n            else\r\n              this.$parsemi.getToken(this.afterGetToken, sch.objectId, dialog.data);\r\n          });\r\n      },\r\n      afterGetToken(data){\r\n        if(data){\r\n          const gts = this.getTimeString(data);\r\n          if(gts.eDiff > 0){\r\n            this.savePresence(this.schedules[this.scheduleIndex], this.scheduleIndex, null, data.token);\r\n\r\n            if(this.$parsemi.isPos('Siswa')){\r\n              const name =  this.$parsemi.current().name;\r\n              const message = {messageKey: this.schedules[this.scheduleIndex].objectId, owner: \"Bot\", message: name + \" telah masuk.\"};\r\n              this.$parsemi.setMessage(()=>{}, message);\r\n            }\r\n        \r\n          } else {\r\n            this.$dialog.alert({title: \"Informasi\", body: \"Waktu Token ini habis. Silahkan hubungi Pengajar.\"}, {okText: \"Ok\"});\r\n          }\r\n        } else {\r\n          this.$dialog.alert({title: \"Informasi\", body: \"Token tidak tersedia!\"}, {okText: \"Ok\"});\r\n        }\r\n      },\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n      if(sto)\r\n        clearTimeout(sto);\r\n      next();\r\n    }\r\n  }\r\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Schedule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Schedule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./schedule.html?vue&type=template&id=3d8fae35&scoped=true&\"\nimport script from \"./Schedule.vue?vue&type=script&lang=js&\"\nexport * from \"./Schedule.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Schedule.vue?vue&type=style&index=0&id=3d8fae35&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d8fae35\",\n  null\n  \n)\n\nexport default component.exports","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n"],"sourceRoot":""}