{"version":3,"sources":["webpack:///./src/components/tile/tile-presence.html","webpack:///src/components/tile/TilePresence.vue","webpack:///./src/components/tile/TilePresence.vue?e13f","webpack:///./src/components/tile/TilePresence.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","user","name","objectId","uIndex","_e","domProps","presenceStat","isPresenced","presenceStatus","$parsemi","isPos","on","$event","removePresence","onPresence","_m","staticStyle","staticRenderFns","attrs","component"],"mappings":"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","file":"js/chunk-2d22e138.89591133.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.user)?_c('div',{staticClass:\"tile tile-centered\"},[_c('div',{staticClass:\"tile-content\"},[_c('div',{staticClass:\"tile-title text-bold\"},[_vm._v(_vm._s(_vm.user.name)+\" \"),(_vm.user.objectId == _vm.uIndex)?_c('span',{staticClass:\"badge\"}):_vm._e()]),_c('div',{domProps:{\"innerHTML\":_vm._s(_vm.presenceStat())}})]),(_vm.isPresenced())?_c('div',{staticClass:\"btn-group\"},[_c('div',{domProps:{\"innerHTML\":_vm._s(_vm.presenceStatus())}}),(_vm.$parsemi.isPos('Guru'))?_c('button',{staticClass:\"btn btn-default\",on:{\"click\":function($event){return _vm.removePresence()}}},[_c('i',{staticClass:\"icon icon-cross\"})]):_vm._e()]):_vm._e(),(!_vm.isPresenced() && _vm.$parsemi.isPos('Guru'))?_c('div',{staticClass:\"tile-action\"},[_c('div',{staticClass:\"dropdown dropdown-right\"},[_c('div',{staticClass:\"btn-group\"},[_c('a',{staticClass:\"btn btn-success\",on:{\"click\":function($event){return _vm.onPresence('Tepat')}}},[_vm._v(\"Tepat\")]),_c('a',{staticClass:\"btn\",on:{\"click\":function($event){return _vm.onPresence('Lambat')}}},[_vm._v(\"Lambat\")]),_vm._m(0),_c('ul',{staticClass:\"menu\",staticStyle:{\"margin-bottom\":\"70px\"}},[_c('li',{staticClass:\"menu-item\"},[_c('a',{on:{\"click\":function($event){return _vm.onPresence('Dispen')}}},[_vm._v(\"Dispen\")])]),_c('li',{staticClass:\"menu-item\"},[_c('a',{on:{\"click\":function($event){return _vm.onPresence('Sakit')}}},[_vm._v(\"Sakit\")])]),_c('li',{staticClass:\"menu-item\"},[_c('a',{on:{\"click\":function($event){return _vm.onPresence('Izin')}}},[_vm._v(\"Izin\")])]),_c('li',{staticClass:\"menu-item\"},[_c('a',{on:{\"click\":function($event){return _vm.onPresence('Alpa')}}},[_vm._v(\"Alpa\")])])])])])]):_vm._e()]):_vm._e()}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a',{staticClass:\"btn btn-error dropdown-toggle\",attrs:{\"tabindex\":\"0\"}},[_c('i',{staticClass:\"icon icon-arrow-down\"})])}]\n\nexport { render, staticRenderFns }","<template src=\"./tile-presence.html\" />\r\n\r\n<script>\r\n  let loader = null;\r\n  export default {\r\n    name: 'TilePresence',\r\n    props: [\"schedule\", \"user\", \"index\", \"update\", \"uIndex\"],\r\n    data(){\r\n      return {\r\n        today: this.$parsemi.today(),\r\n      }\r\n    },\r\n    methods: {\r\n      presenceStat(){\r\n        const presence = this.user.presence;\r\n        let persM = 0;\r\n        let persT = 0;\r\n        if(presence){\r\n          const t = presence.get('total');\r\n          const Total = t.Total | 0;\r\n          const Tepat = t.Tepat | 0;\r\n          const Lambat = t.Lambat | 0;\r\n          if(Total > 0){\r\n            persM = (Tepat+Lambat)/Total*100;\r\n            persT = 100-persM;\r\n          }\r\n        }\r\n        return `<small class=\"tile-subtitle text-success\"><i class=\"icon icon-check\"></i> `+persM+`%</small>\r\n          <small class=\"tile-subtitle text-error ml-10\"><i class=\"icon icon-cross\"></i> `+persT+`%</small>`;\r\n      },\r\n      isPresenced(){\r\n        const presence = this.user.presence;\r\n        if(presence){\r\n          const md = presence.get('metaData');\r\n          if(md.length > 0){\r\n            return md[this.today.weekMonth];\r\n          }\r\n        }\r\n        return false;\r\n      },\r\n      presenceStatus(){\r\n        if(!this.user.presence)\r\n          return;\r\n        const md = this.user.presence.get('metaData');\r\n        const status = md[this.today.weekMonth].status;\r\n        let style = \"default\";\r\n        switch(status){\r\n          case 'Tepat':\r\n            style = \"success\";\r\n            break;\r\n          case 'Lambat':\r\n            style = \"secondary\";\r\n            break;\r\n          case 'Sakit':\r\n            style = \"warning\";\r\n            break;\r\n          case 'Dispen':\r\n            style = \"primary\";\r\n            break;\r\n          case 'Alpa':\r\n            style = \"error\";\r\n            break;\r\n        }\r\n        return `<button class=\"btn btn-rounded btn-`+style+`\">`+status+`</button>`;\r\n      },\r\n      removePresence(){\r\n        loader = this.$loading.show();\r\n        let presence = this.user.presence;\r\n        let metaData = presence.get('metaData');\r\n        const mdStatus = metaData[this.today.weekMonth];\r\n        const status = mdStatus.status;\r\n        let total = presence.get('total');\r\n        total.Total = total.Total > 0 ? (total.Total - 1) : 0;\r\n        total[status] = total[status] > 0 ? (total[status] - 1) : 0;\r\n        metaData[this.today.weekMonth] = null;\r\n        presence.set('metaData', metaData);\r\n        presence.set('total', total);\r\n        presence.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler);\r\n      },\r\n      onPresence(status){\r\n        loader = this.$loading.show();\r\n        const mdNow = {'status': status, 'approve': this.$parsemi.current().objectId, 'subject': this.schedule.subject.objectId, 'date': this.$parsemi.today().dDate, 'source': 'Guru'};\r\n        let presence = this.user.presence;\r\n        if(presence){\r\n          let metaData = presence.get('metaData');\r\n          metaData[this.today.weekMonth] = mdNow;\r\n          let total = presence.get('total');\r\n          total.Total = total.Total > 0 ? (total.Total + 1) : 1;\r\n          total[status] = total[status] > 0 ? (total[status] + 1) : 1;\r\n          presence.set('metaData', metaData);\r\n          presence.set('total', total);\r\n          presence.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler);\r\n        } else {\r\n          let presenceData = {\r\n            owner: {__type:'Pointer',className:'_User',objectId: this.user.objectId},\r\n            schedule: {__type:'Pointer',className:'Schedule',objectId:this.schedule.objectId},\r\n            dMonth: this.today.dMonth,\r\n            total: { Total: 1 },\r\n            metaData: [null, null, null, null],\r\n          };\r\n          presenceData.total['Week'] = this.getNumbersDow(this.schedule.dow);\r\n          presenceData.total[status] = 1;\r\n          presenceData.metaData[this.today.weekMonth] = mdNow;\r\n          this.$parsemi.setPresence(presenceData, this.settlePresence);\r\n        }\r\n      },\r\n      settlePresence(d){\r\n        let user = {...this.user};\r\n        user.presence = d;\r\n        this.$emit(\"update\", user, this.index);\r\n        if(loader)\r\n          loader.hide();\r\n      },\r\n      getNumbersDow(dow){\r\n        const date = this.$parsemi.local();\r\n        if(dow > 7) \r\n          return false;\r\n        const numDays = new Date(date.getFullYear(), date.getMonth()+1, 0).getDate();\r\n        if(numDays == 28){\r\n          return 4;\r\n        }\r\n        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);\r\n        const firstDow = firstDay.getDay() + 1;\r\n        if(numDays == 29){\r\n          if(dow == firstDow)\r\n            return 5;\r\n          else\r\n            return 4;\r\n        }\r\n        const rule = {'30': 1, '31': 2};\r\n        const max = (firstDow + rule[numDays]);\r\n        if(dow >= firstDow && dow <= max){\r\n          return 5;\r\n        }\r\n        // if out of week number\r\n        if(max > 7){\r\n          const rd = max % 7;\r\n          if(dow <= rd)\r\n            return 5;\r\n          else \r\n            return 4;\r\n        }\r\n        return 4;\r\n      },\r\n\r\n    }\r\n  }\r\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TilePresence.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TilePresence.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./tile-presence.html?vue&type=template&id=44233163&\"\nimport script from \"./TilePresence.vue?vue&type=script&lang=js&\"\nexport * from \"./TilePresence.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}