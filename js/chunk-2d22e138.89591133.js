(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22e138"],{f9e4:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.user?s("div",{staticClass:"tile tile-centered"},[s("div",{staticClass:"tile-content"},[s("div",{staticClass:"tile-title text-bold"},[e._v(e._s(e.user.name)+" "),e.user.objectId==e.uIndex?s("span",{staticClass:"badge"}):e._e()]),s("div",{domProps:{innerHTML:e._s(e.presenceStat())}})]),e.isPresenced()?s("div",{staticClass:"btn-group"},[s("div",{domProps:{innerHTML:e._s(e.presenceStatus())}}),e.$parsemi.isPos("Guru")?s("button",{staticClass:"btn btn-default",on:{click:function(t){return e.removePresence()}}},[s("i",{staticClass:"icon icon-cross"})]):e._e()]):e._e(),!e.isPresenced()&&e.$parsemi.isPos("Guru")?s("div",{staticClass:"tile-action"},[s("div",{staticClass:"dropdown dropdown-right"},[s("div",{staticClass:"btn-group"},[s("a",{staticClass:"btn btn-success",on:{click:function(t){return e.onPresence("Tepat")}}},[e._v("Tepat")]),s("a",{staticClass:"btn",on:{click:function(t){return e.onPresence("Lambat")}}},[e._v("Lambat")]),e._m(0),s("ul",{staticClass:"menu",staticStyle:{"margin-bottom":"70px"}},[s("li",{staticClass:"menu-item"},[s("a",{on:{click:function(t){return e.onPresence("Dispen")}}},[e._v("Dispen")])]),s("li",{staticClass:"menu-item"},[s("a",{on:{click:function(t){return e.onPresence("Sakit")}}},[e._v("Sakit")])]),s("li",{staticClass:"menu-item"},[s("a",{on:{click:function(t){return e.onPresence("Izin")}}},[e._v("Izin")])]),s("li",{staticClass:"menu-item"},[s("a",{on:{click:function(t){return e.onPresence("Alpa")}}},[e._v("Alpa")])])])])])]):e._e()]):e._e()},n=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a",{staticClass:"btn btn-error dropdown-toggle",attrs:{tabindex:"0"}},[s("i",{staticClass:"icon icon-arrow-down"})])}],i=s("5530"),r=null,c={name:"TilePresence",props:["schedule","user","index","update","uIndex"],data:function(){return{today:this.$parsemi.today()}},methods:{presenceStat:function(){var e=this.user.presence,t=0,s=0;if(e){var a=e.get("total"),n=0|a.Total,i=0|a.Tepat,r=0|a.Lambat;n>0&&(t=(i+r)/n*100,s=100-t)}return'<small class="tile-subtitle text-success"><i class="icon icon-check"></i> '+t+'%</small>\n        <small class="tile-subtitle text-error ml-10"><i class="icon icon-cross"></i> '+s+"%</small>"},isPresenced:function(){var e=this.user.presence;if(e){var t=e.get("metaData");if(t.length>0)return t[this.today.weekMonth]}return!1},presenceStatus:function(){if(this.user.presence){var e=this.user.presence.get("metaData"),t=e[this.today.weekMonth].status,s="default";switch(t){case"Tepat":s="success";break;case"Lambat":s="secondary";break;case"Sakit":s="warning";break;case"Dispen":s="primary";break;case"Alpa":s="error";break}return'<button class="btn btn-rounded btn-'+s+'">'+t+"</button>"}},removePresence:function(){r=this.$loading.show();var e=this.user.presence,t=e.get("metaData"),s=t[this.today.weekMonth],a=s.status,n=e.get("total");n.Total=n.Total>0?n.Total-1:0,n[a]=n[a]>0?n[a]-1:0,t[this.today.weekMonth]=null,e.set("metaData",t),e.set("total",n),e.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler)},onPresence:function(e){r=this.$loading.show();var t={status:e,approve:this.$parsemi.current().objectId,subject:this.schedule.subject.objectId,date:this.$parsemi.today().dDate,source:"Guru"},s=this.user.presence;if(s){var a=s.get("metaData");a[this.today.weekMonth]=t;var n=s.get("total");n.Total=n.Total>0?n.Total+1:1,n[e]=n[e]>0?n[e]+1:1,s.set("metaData",a),s.set("total",n),s.save(this.$parsemi.sessionToken()).then(this.settlePresence).catch(this.$parsemi.errorHandler)}else{var i={owner:{__type:"Pointer",className:"_User",objectId:this.user.objectId},schedule:{__type:"Pointer",className:"Schedule",objectId:this.schedule.objectId},dMonth:this.today.dMonth,total:{Total:1},metaData:[null,null,null,null]};i.total["Week"]=this.getNumbersDow(this.schedule.dow),i.total[e]=1,i.metaData[this.today.weekMonth]=t,this.$parsemi.setPresence(i,this.settlePresence)}},settlePresence:function(e){var t=Object(i["a"])({},this.user);t.presence=e,this.$emit("update",t,this.index),r&&r.hide()},getNumbersDow:function(e){var t=this.$parsemi.local();if(e>7)return!1;var s=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();if(28==s)return 4;var a=new Date(t.getFullYear(),t.getMonth(),1),n=a.getDay()+1;if(29==s)return e==n?5:4;var i={30:1,31:2},r=n+i[s];if(e>=n&&e<=r)return 5;if(r>7){var c=r%7;return e<=c?5:4}return 4}}},o=c,l=s("2877"),u=Object(l["a"])(o,a,n,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-2d22e138.89591133.js.map